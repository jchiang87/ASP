<?xml version="1.0" encoding="UTF-8"?>
<pipeline xmlns="http://glast-ground.slac.stanford.edu/pipeline" xmlns:xs="http://www.w3.org/2001/XMLSchema-instance" xs:schemaLocation="http://glast-ground.slac.stanford.edu/pipeline http://glast-ground.slac.stanford.edu/Pipeline-II/schemas/2.0/pipeline.xsd">
  <task name="RegisterData" type="Data" version="0.4">
    <notation>Registering DC2 data</notation>
    <prerequisites>
      <prerequisite name="numFiles" type="integer"/>
      <prerequisite name="PYASPROOT" type="string"/>
      <prerequisite name="BINDIR" type="string"/>
    </prerequisites>
    <process name="computeFileInfo">
      <job executable="${PYASPROOT}/${BINDIR}/computeFileInfo.sh" maxCPU="60"/>
    </process>
    <process name="registerDataset">
      <script language="python">
        <![CDATA[
        fileInfo = pipeline.getProcessInstance("computeFileInfo")
        downlinkDir = fileInfo.getVariable("downlinkDir")
        downlinkFile = fileInfo.getVariable("downlinkFile")
        tstart = fileInfo.getVariable("tstart")
        tstop = fileInfo.getVariable("tstop")
        dataType = "MC"
        logicalPath = "/DC2/FT1:" + downlinkFile
        filePath = downlinkDir + "/" + downlinkFile
        attributes = "tstart=%s:tstop=%s" % (tstart, tstop)
        datacatalog.registerDataset(dataType, logicalPath, filePath,
                                    attributes)
        ]]>
      </script>
    </process>
  </task>
</pipeline>

